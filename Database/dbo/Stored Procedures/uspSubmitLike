
CREATE PROCEDURE [dbo].[uspSubmitLike]  
(  			 
@PostId INT, 
@CreatedBy VARCHAR(50),                          
 @LikeBy  VARCHAR(50),
 @Identifier  VARCHAR(10),   
 @Points  VARCHAR(10)                         
)                                                      
AS                                                      
BEGIN        
    BEGIN TRANSACTION;      
      SAVE TRANSACTION MySavePoint;        
     BEGIN TRY  
	 BEGIN               
    INSERT INTO PostLikes  ( PostId,Message, LikeBy,LikeDate,Identifier)
	values ( @PostId,'0',@LikeBy,GETDATE(),@Identifier);		
	END	
	 if(@Identifier ='POST')	
		 BEGIN  
		  INSERT INTO KMTPointEarnSystem ( Points,[Pes_Id], Pes_type,Pes_by,Pes_On)
			values ( @Points,@PostId,'PostLike',@CreatedBy,GETDATE());  
		 END 
	 ELSE if(@Identifier ='BLOG')	
		 BEGIN    
		 INSERT INTO KMTPointEarnSystem ( Points,[Pes_Id], Pes_type,Pes_by,Pes_On)
			values ( @Points,@PostId,'BlogLike',@CreatedBy,GETDATE()); 
		 END  
	 ELSE if(@Identifier ='DOC')	
		 BEGIN    
		 INSERT INTO KMTPointEarnSystem ( Points,[Pes_Id], Pes_type,Pes_by,Pes_On)
			values ( @Points,@PostId,'DocLike',@CreatedBy,GETDATE()); 
		 END 		     			                    
     END TRY       
     BEGIN CATCH      
        IF @@TRANCOUNT > 0      
        BEGIN      
            ROLLBACK TRANSACTION MySavePoint;       
        END      
      END CATCH                                                 
     COMMIT TRANSACTION                                                  
END

GO
