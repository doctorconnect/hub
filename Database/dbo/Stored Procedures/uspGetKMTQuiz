
CREATE PROCEDURE [dbo].[uspGetKMTQuiz]
(
 @CapabilitiesId int,
 @IsAdmin int
 )                
 AS    
 BEGIN    
 BEGIN TRANSACTION;          
 SAVE TRANSACTION MySavePoint;            
 BEGIN TRY
 if(@IsAdmin=0)                   
    BEGIN    
      SELECT Q.QuizID,
	   Q.QuizName,
	   Q.FromDate,
	   Q.ToDate,
	   Q.IsActive,
	   R.UserName as CreatedBy,
	   R.UserEmail AS CreatedEmail
	   FROM [KMTQuiz] Q join  KMTUserRegistration R
	   on R.UserNTID = Q.CreatedBy
	   where Q.CapId = @CapabilitiesId
	   
 END 
 if(@IsAdmin=1)                   
    BEGIN    
      SELECT Q.QuizID,
	   Q.QuizName,
	   Q.FromDate,
	   Q.ToDate,
	   Q.IsActive,
	   R.UserName as CreatedBy,
	   R.UserEmail AS CreatedEmail
	   FROM [KMTQuiz] Q join  KMTUserRegistration R
	    on R.UserNTID = Q.CreatedBy
	 END 
 END TRY    
   BEGIN CATCH    
      IF @@TRANCOUNT > 0          
     BEGIN          
            ROLLBACK TRANSACTION MySavePoint;           
        END    
         END CATCH    
    COMMIT TRANSACTION    
 END
GO
