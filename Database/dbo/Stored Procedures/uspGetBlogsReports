
CREATE PROCEDURE [dbo].[uspGetBlogsReports]        
(      
@StartDate DateTime,      
@EndDate DateTime,      
@Criteria Varchar(50),
@Capid int,
@CapText Varchar(10)
)      
AS 
 IF @CapText IS NULL 
 BEGIN             
BEGIN      
 IF @Criteria='Month-wise'    
 BEGIN      
   SELECT     
   CONCAT(DATEPART(MONTH, BlogDate),'/',DATEPART(YEAR, BlogDate))  AS Interval,     
   COUNT(*) AS Utilization      
   FROM Blogs             
   WHERE  BlogDate>=@StartDate AND BlogDate<=@EndDate  +1  and 
   Capid =  @Capid
   GROUP BY DATEPART(MONTH, BlogDate),    
     DATEPART(YEAR, BlogDate)     
   ORDER BY DATEPART(YEAR, BlogDate), DATEPART(MONTH, BlogDate)      
 END    
 ELSE IF @Criteria='Week-wise'    
 BEGIN      
   SELECT     
   CONCAT(DATEPART(MONTH, BlogDate),'/',DATEPART(YEAR, BlogDate), ' Week', DATEPART(WEEK, BlogDate))  AS Interval,     
   COUNT(*) AS Utilization      
   FROM Blogs             
   WHERE  BlogDate>=@StartDate AND BlogDate<=@EndDate  +1   and Capid =  @Capid
   GROUP BY DATEPART(WEEK, BlogDate),    
     DATEPART(MONTH, BlogDate),    
     DATEPART(YEAR, BlogDate)     
   ORDER BY DATEPART(YEAR, BlogDate), DATEPART(MONTH, BlogDate), DATEPART(WEEK, BlogDate)      
 END    
 ELSE IF @Criteria='Day-wise'    
 BEGIN      
   SELECT     
   CONCAT(DATEPART(MONTH, BlogDate),'/',DATEPART(DAY, BlogDate),'/',DATEPART(YEAR, BlogDate))  AS Interval,     
   COUNT(*) AS Utilization      
   FROM Blogs             
   WHERE  BlogDate>=@StartDate AND BlogDate<=@EndDate  +1   and Capid =  @Capid 
   GROUP BY DATEPART(DAY, BlogDate),    
     DATEPART(MONTH, BlogDate),    
     DATEPART(YEAR, BlogDate)     
   ORDER BY DATEPART(YEAR, BlogDate), DATEPART(MONTH, BlogDate), DATEPART(DAY, BlogDate)    
 END    
 ELSE    
 BEGIN    
   SELECT     
   CONCAT(DATEPART(MONTH, BlogDate),'/',DATEPART(DAY, BlogDate),'/',DATEPART(YEAR, BlogDate), ' ',DATEPART(HOUR, BlogDate), ':00')  AS Interval,     
   COUNT(*) AS Utilization      
   FROM Blogs             
   WHERE  BlogDate>=@StartDate AND BlogDate<=@EndDate  +1    and Capid =  @Capid
   GROUP BY DATEPART(HOUR, BlogDate),    
     DATEPART(DAY, BlogDate),    
     DATEPART(MONTH, BlogDate),    
     DATEPART(YEAR, BlogDate)    
   ORDER BY DATEPART(YEAR, BlogDate), DATEPART(MONTH, BlogDate), DATEPART(DAY, BlogDate), DATEPART(HOUR, BlogDate)    
 END     
END
END
 IF @CapText='ALL'
 BEGIN 
 BEGIN      
 IF @Criteria='Month-wise'    
 BEGIN      
   SELECT     
   CONCAT(DATEPART(MONTH, BlogDate),'/',DATEPART(YEAR, BlogDate))  AS Interval,     
   COUNT(*) AS Utilization      
   FROM Blogs             
   WHERE  BlogDate>=@StartDate AND BlogDate<=@EndDate  +1  
   GROUP BY DATEPART(MONTH, BlogDate),    
     DATEPART(YEAR, BlogDate)     
   ORDER BY DATEPART(YEAR, BlogDate), DATEPART(MONTH, BlogDate)      
 END    
 ELSE IF @Criteria='Week-wise'    
 BEGIN      
   SELECT     
   CONCAT(DATEPART(MONTH, BlogDate),'/',DATEPART(YEAR, BlogDate), ' Week', DATEPART(WEEK, BlogDate))  AS Interval,     
   COUNT(*) AS Utilization      
   FROM Blogs             
   WHERE  BlogDate>=@StartDate AND BlogDate<=@EndDate  +1   
   GROUP BY DATEPART(WEEK, BlogDate),    
     DATEPART(MONTH, BlogDate),    
     DATEPART(YEAR, BlogDate)     
   ORDER BY DATEPART(YEAR, BlogDate), DATEPART(MONTH, BlogDate), DATEPART(WEEK, BlogDate)      
 END    
 ELSE IF @Criteria='Day-wise'    
 BEGIN      
   SELECT     
   CONCAT(DATEPART(MONTH, BlogDate),'/',DATEPART(DAY, BlogDate),'/',DATEPART(YEAR, BlogDate))  AS Interval,     
   COUNT(*) AS Utilization      
   FROM Blogs             
   WHERE  BlogDate>=@StartDate AND BlogDate<=@EndDate  +1  
   GROUP BY DATEPART(DAY, BlogDate),    
     DATEPART(MONTH, BlogDate),    
     DATEPART(YEAR, BlogDate)     
   ORDER BY DATEPART(YEAR, BlogDate), DATEPART(MONTH, BlogDate), DATEPART(DAY, BlogDate)    
 END    
 ELSE    
 BEGIN    
   SELECT     
   CONCAT(DATEPART(MONTH, BlogDate),'/',DATEPART(DAY, BlogDate),'/',DATEPART(YEAR, BlogDate), ' ',DATEPART(HOUR, BlogDate), ':00')  AS Interval,     
   COUNT(*) AS Utilization      
   FROM Blogs             
   WHERE  BlogDate>=@StartDate AND BlogDate<=@EndDate  +1    
   GROUP BY DATEPART(HOUR, BlogDate),    
     DATEPART(DAY, BlogDate),    
     DATEPART(MONTH, BlogDate),    
     DATEPART(YEAR, BlogDate)    
   ORDER BY DATEPART(YEAR, BlogDate), DATEPART(MONTH, BlogDate), DATEPART(DAY, BlogDate), DATEPART(HOUR, BlogDate)    
 END     
END
 END

GO
