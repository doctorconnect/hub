
CREATE PROCEDURE [dbo].[uspGetTraining]                  
(
 @CapabilitiesId int,
 @IsAdmin int
 )                
 AS    
 BEGIN    
 BEGIN TRANSACTION;          
 SAVE TRANSACTION MySavePoint;            
 BEGIN TRY
 if(@IsAdmin=0)  
 BEGIN   
      select 
	 c.Id	
	,c.Title	
	,c.Url	
	,c.FromDate	
	,c.ToDate	
	,c.IsActive	
	,R.username as CREATEDBY	
	,c.Createdon	
	,c.ModifiedBy	
	,c.ModifiedOn from KMTTraining c join [KMTUserRegistration] R on R.userNtid=c.CREATEDBY
	where C.CapId = @CapabilitiesId
	order by c.CreatedOn desc
	END
	if(@IsAdmin=1)  
 BEGIN   
      select 
	 c.Id	
	,c.Title	
	,c.Url	
	,c.FromDate	
	,c.ToDate	
	,c.IsActive	
	,R.username as CREATEDBY	
	,c.Createdon	
	,c.ModifiedBy	
	,c.ModifiedOn from KMTTraining c join [KMTUserRegistration] R on R.userNtid=c.CREATEDBY
	order by c.CreatedOn desc
	END
 END TRY    
   BEGIN CATCH    
      IF @@TRANCOUNT > 0          
     BEGIN          
            ROLLBACK TRANSACTION MySavePoint;           
        END    
         END CATCH    
    COMMIT TRANSACTION    
 END
GO
