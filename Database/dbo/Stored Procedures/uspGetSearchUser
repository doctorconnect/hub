
CREATE PROCEDURE [dbo].[uspGetSearchUser]
@Name varchar(20),
@CapabilitiesId int,    
@IsAdmin int      
  AS    
 BEGIN    
    BEGIN TRANSACTION;          
     SAVE TRANSACTION MySavePoint;            
      BEGIN TRY  
if(@IsAdmin=0)   
    BEGIN  
   select id, 
   UserCode,
   ManagerName,
   UserEmail ,
   UserNTID ,
   UserName from  KMTUserRegistration where (UserName like '%' + @Name + '%' or UserCode like '%' + @Name + '%')
   and CapabilitiesId =@CapabilitiesId;                
    END  
if(@IsAdmin=1)   
    BEGIN  
   select id, 
   UserCode,
   ManagerName,
   UserEmail ,
   UserNTID ,
   UserName from  KMTUserRegistration where UserName like '%' + @Name + '%' or UserCode like '%' + @Name + '%';                  
    END  	     
      END TRY    
   BEGIN CATCH    
      IF @@TRANCOUNT > 0          
     BEGIN          
            ROLLBACK TRANSACTION MySavePoint;           
        END    
         END CATCH    
    COMMIT TRANSACTION    
 END

GO
